============================================================================================================

Question 2 : Create a cursor to find list of all employees jn a deoartment passed as an argument from
             the employee table.

============================================================================================================

DELIMITER //

MariaDB [test]> CREATE PROCEDURE create_tables()
    ->     BEGIN
    ->         create table department(
    ->             dept_id int primary key,
    ->             deptname varchar(30)
    ->         );
    ->
    ->         create table employee(
    ->             emp_id int primary key auto_increment,
    ->             empname varchar(30),
    ->             dept_id int,
    ->             designation varchar(20),
    ->             salary decimal(10,2),
    ->             FOREIGN KEY (dept_id) REFERENCES department(dept_id)
    ->         );
    ->
    ->     END //
Query OK, 0 rows affected (0.021 sec)

MariaDB [test]> call create_tables() //
Query OK, 0 rows affected (0.125 sec)

***************************************************************************************

MariaDB [test]> CREATE PROCEDURE insert_data()
    ->     BEGIN
    ->         insert into department values(1,'Accounts'),
    ->         (2,'Production'),
    ->         (3,'Marketing');
    ->
    ->         insert into employee values(1,'Pradip',1,'Manager',80000),
    ->         (2,'Ajinkya',2,'Clerk',60000),
    ->         (3,'Nirav',3,'Staff',50000),
    ->         (4,'Milind',2,'Manager',60000),
    ->         (5,'Lakshya',3,'Staff',90000);
    ->     END //
Query OK, 0 rows affected (0.020 sec)

MariaDB [test]> call insert_data() //
Query OK, 8 rows affected (0.032 sec)

MariaDB [test]> select * from employee //
+--------+---------+---------+-------------+----------+
| emp_id | empname | dept_id | designation | salary   |
+--------+---------+---------+-------------+----------+
|      1 | Pradip  |       1 | Manager     | 80000.00 |
|      2 | Ajinkya |       2 | Clerk       | 60000.00 |
|      3 | Nirav   |       3 | Staff       | 50000.00 |
|      4 | Milind  |       2 | Manager     | 60000.00 |
|      5 | Lakshya |       3 | Staff       | 90000.00 |
+--------+---------+---------+-------------+----------+
5 rows in set (0.000 sec)

MariaDB [test]> select * from department //
+---------+------------+
| dept_id | deptname   |
+---------+------------+
|       1 | Accounts   |
|       2 | Production |
|       3 | Marketing  |
+---------+------------+
3 rows in set (0.000 sec)

***************************************************************************************

MariaDB [test]> set @dname = 'Production' //
Query OK, 0 rows affected (0.000 sec)

MariaDB [test]> set @list = '' //
Query OK, 0 rows affected (0.000 sec)

MariaDB [test]> CREATE PROCEDURE cur_pro(IN dept_name varchar(100), INOUT list varchar(100))
    ->     BEGIN
    ->     DECLARE emp_name varchar(50);
    ->     DECLARE c_finish integer DEFAULT 0;
    ->     DECLARE curs cursor for select empname from employee where dept_id = (select dept_id from department where deptname = dept_name );
    ->     DECLARE CONTINUE HANDLER for NOT FOUND set c_finish = 1;
    ->     OPEN curs;
    ->     get_line : LOOP
    ->         FETCH curs into emp_name;
    ->         IF c_finish = 1 THEN
    ->             LEAVE get_line;
    ->         END IF;
    ->         set list = CONCAT(list,CONCAT(emp_name, " | "));
    ->     END LOOP get_line;
    ->     CLOSE curs;
    ->     END //
Query OK, 0 rows affected (0.021 sec)

MariaDB [test]> DELIMITER ;
MariaDB [test]> call cur_pro(@dname,@list);
Query OK, 0 rows affected (0.000 sec)

MariaDB [test]> select @list as LISTS;
+---------------------+
| LISTS               |
+---------------------+
| Ajinkya | Milind |  |
+---------------------+
1 row in set (0.000 sec)



==================================================================================================

Qusetion 3 : Create a cursor to increment the salary based on the designation

==================================================================================================

DELIMITER //

MariaDB [test]> set @increment = 1000 //
Query OK, 0 rows affected (0.000 sec)

MariaDB [test]> set @designation = 'Staff' //
Query OK, 0 rows affected (0.000 sec)


MariaDB [test]> CREATE PROCEDURE salary_increment(IN desig varchar(30) , IN incre decimal(10,2) )
    -> BEGIN
    ->     DECLARE empid int;
    ->     DECLARE saly decimal(10,2);
    ->     DECLARE c_finish integer DEFAULT 0;
    ->     DECLARE curs cursor for select emp_id,salary from employee where designation = desig;
    ->     DECLARE CONTINUE HANDLER for NOT FOUND set c_finish = 1;
    ->     OPEN curs;
    ->     get_line : LOOP
    ->         FETCH curs into empid,saly;
    ->         IF c_finish = 1 THEN
    ->             LEAVE get_line;
    ->         END IF;
    ->         UPDATE employee set salary = (saly + incre) where emp_id = empid;
    ->     END LOOP get_line;
    ->     CLOSE curs;
    -> END //
Query OK, 0 rows affected (0.022 sec)

MariaDB [test]> DELIMITER ;

MariaDB [test]> call salary_increment(@designation,@increment);
Query OK, 2 rows affected (0.022 sec)

MariaDB [test]> select * from employee;
+--------+---------+---------+-------------+----------+
| emp_id | empname | dept_id | designation | salary   |
+--------+---------+---------+-------------+----------+
|      1 | Pradip  |       1 | Manager     | 80000.00 |
|      2 | Ajinkya |       2 | Clerk       | 60000.00 |
|      3 | Nirav   |       3 | Staff       | 51000.00 | 
|      4 | Milind  |       2 | Manager     | 60000.00 |
|      5 | Lakshya |       3 | Staff       | 91000.00 |
+--------+---------+---------+-------------+----------+
5 rows in set (0.000 sec)

=====================================================================================================

